<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Binary Image Encoder</title>

  <!-- Bootstrap 5 -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">

  <style>
    body { background: #0b1220; color: #e9eef8; }
    .card { background: rgba(255,255,255,0.03); border: 1px solid rgba(255,255,255,0.06); }
    .muted { color: #b7c0d6; }
    .preview-img { max-width: 100%; height: auto; border-radius: 6px; }
    .small-muted { font-size: .85rem; color: #a9b4d1; }
  </style>
</head>
<body>
  <div data-component="header"></div>

  <main class="container py-4">
    <div class="row g-4">
      <!-- Left: Encode -->
      <div class="col-lg-6">
        <div class="card p-3 h-100">
          <div class="d-flex justify-content-between align-items-start">
            <h5 class="mb-2 text-light">üì§ Archivo ‚Üí Imagen</h5>
            <small class="muted">Selecciona y convierte</small>
          </div>

          <div class="mb-2">
            <label class="form-label small-muted">Archivo</label>
            <input id="steg-in-file" type="file" class="form-control">
            <div class="form-text small-muted">Archivos peque√±os/medianos recomendados (ver notas).</div>
          </div>

          <div class="mb-2">
            <label class="form-label small-muted">Contrase√±a (opcional)</label>
            <input id="steg-in-pass" type="password" class="form-control" placeholder="Si quieres cifrar el contenido">
          </div>

          <div class="d-flex gap-2 mb-3">
            <button id="steg-encode-btn" class="btn btn-primary flex-grow-1">Convertir a PNG</button>
            <a id="steg-download-link" class="btn btn-success d-none" role="button">Descargar PNG</a>
          </div>

          <div class="border rounded p-2 text-center" style="min-height:160px;">
            <div id="steg-preview" class="d-flex justify-content-center align-items-center w-100 h-100">
              <span class="small-muted">Vista previa aparecer√° aqu√≠</span>
            </div>
          </div>

          <div class="mt-3">
            <small class="small-muted">Consejo: no conviertas im√°genes con compresi√≥n (JPEG) si esperas recuperar bits exactos.</small>
          </div>
        </div>
      </div>

      <!-- Right: Decode -->
      <div class="col-lg-6">
        <div class="card p-3 h-100">
          <div class="d-flex justify-content-between align-items-start">
            <h5 class="mb-2 text-light">üì• Imagen ‚Üí Archivo</h5>
            <small class="muted">Recupera archivos desde PNG</small>
          </div>

          <div class="mb-2">
            <label class="form-label small-muted">Imagen PNG</label>
            <input id="steg-in-image" type="file" accept="image/png" class="form-control">
          </div>

          <div class="mb-2">
            <label class="form-label small-muted">Contrase√±a (si la imagen est√° cifrada)</label>
            <input id="steg-in-image-pass" type="password" class="form-control" placeholder="Contrase√±a (si aplica)">
          </div>

          <div class="d-flex gap-2 mb-3">
            <button id="steg-decode-btn" class="btn btn-outline-light flex-grow-1">Recuperar archivo</button>
            <button id="steg-reset-btn" class="btn btn-outline-danger">Limpiar</button>
          </div>

          <div class="border rounded p-3">
            <div id="steg-decoded-info" class="small-muted">Aqu√≠ ver√°s informaci√≥n del archivo recuperado.</div>
          </div>

          <div class="mt-3 small-muted">
            <ul class="mb-0">
              <li>Formato: 1 bit/pixel ‚Äî gris = 1, negro = 0 (misma l√≥gica que tu script Python).</li>
              <li>Soporta AES-GCM con PBKDF2 (si usas contrase√±a).</li>
            </ul>
          </div>
        </div>
      </div>

      <!-- Footer card / notas -->
      <div class="col-12">
        <div class="card p-3">
          <div class="row">
            <div class="col-md-8">
              <h6 class="mb-1 text-light">Notas r√°pidas</h6>
              <p class="mb-0 muted small-muted">
                ‚Ä¢ Este HTML necesita el m√≥dulo JS `src/js/steg.js` (export: <code>wireStegUI</code>).<br>
                ‚Ä¢ Riesgos: si la imagen se convierte a JPG u otra compresi√≥n los bits se corrompen.<br>
                ‚Ä¢ Rendimiento: grandes archivos generan im√°genes muy grandes (consumo de memoria). Para mejorar usa empaquetado por canales RGBA.
              </p>
            </div>
          </div>
        </div>
      </div>
    </div>
  </main>

  <footer class="text-center py-3 text-muted small-muted">
    <div class="container">Demo educativo ‚Äî no usar para secretos cr√≠ticos sin revisi√≥n</div>
  </footer>

  <!-- Script: importa tu m√≥dulo steg.js y enlaza la UI -->
  <script type="module">
    import { wireStegUI } from '../src/js/steg.js';

    document.addEventListener('DOMContentLoaded', () => {
      // conecta el UI al contenedor root (seleccionador fijo)
      wireStegUI('body'); // busca los IDs dentro del documento

      // reset button
      const resetBtn = document.getElementById('steg-reset-btn');
      resetBtn?.addEventListener('click', () => {
        document.getElementById('steg-in-file').value = '';
        document.getElementById('steg-in-pass').value = '';
        document.getElementById('steg-in-image').value = '';
        document.getElementById('steg-in-image-pass').value = '';
        document.getElementById('steg-preview').innerHTML = '<span class="small-muted">Vista previa aparecer√° aqu√≠</span>';
        document.getElementById('steg-decoded-info').textContent = 'Aqu√≠ ver√°s informaci√≥n del archivo recuperado.';
        const dl = document.getElementById('steg-download-link');
        if (dl) { dl.classList.add('d-none'); dl.removeAttribute('href'); }
      });

      // ayuda r√°pida
      document.getElementById('open-readme')?.addEventListener('click', (e) => {
        e.preventDefault();
        alert('Instrucciones:\n1) Selecciona un archivo y (opcional) contrase√±a. 2) Convertir ‚Üí Descargar PNG.\n3) Para recuperar, selecciona la PNG y escribe la contrase√±a si corresponde.');
      });
    });
  </script>
  <script src="../src/js/component-loader.js"></script>

  <!-- Bootstrap JS (opcional, para componentes) -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
